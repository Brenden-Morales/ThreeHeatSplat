<!DOCTYPE html>
<html lang="en" style="width:100%;height:100%;margin:0px;padding:0px">
<head>
    <meta charset="UTF-8">
    <title>Three.js Webgl Heatmap</title>
</head>
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
<!-- pass through vertex shader -->
<script id="passThroughVertex" type="x-shader/x-vertex">
        void main()	{
            gl_Position = vec4( position, 1.0 );
        }
    </script>

<script id="gaussianFragment" type="x-shader/x-fragment">
        uniform vec2 size;
        uniform float intensity;

        float d(vec2 a, vec2 b) {
            float c = 0.9;
            float q = 0.9;
            float p = 0.9;
            return p * pow(max(0.0, 1.0 - distance(a, b) / (0.25 + q * 0.25)), 2.0);
        }

        void main(){
            vec2 uv = gl_FragCoord.xy / size.xy;

            vec2 center = vec2(0.5,0.5);
            float weight = d(uv,center);
            gl_FragColor = vec4(weight * intensity,0.0,0.0,1.0);
        }
    </script>

<script id="heatBlendFragment" type="x-shader/x-fragment">
        uniform vec2 resolution;
        uniform sampler2D heatMap;

        vec3 fromRedToGreen( float interpolant )
        {
            if( interpolant < 0.5 )
            {
               return vec3(1.0, 2.0 * interpolant, 0.0);
            }
            else
            {
                return vec3(2.0 - 2.0 * interpolant, 1.0, 0.0 );
            }
        }


        vec3 fromGreenToBlue( float interpolant )
        {
            if( interpolant < 0.5 )
            {
               return vec3(0.0, 1.0, 2.0 * interpolant);
            }
            else
            {
                return vec3(0.0, 2.0 - 2.0 * interpolant, 1.0 );
            }
        }

        vec3 heat5( float interpolant )
        {
            float invertedInterpolant = interpolant;
            if( invertedInterpolant < 0.5 )
            {
                float remappedFirstHalf = 1.0 - 2.0 * invertedInterpolant;
                return fromGreenToBlue( remappedFirstHalf );
            }
            else
            {
                float remappedSecondHalf = 2.0 - 2.0 * invertedInterpolant;
                return fromRedToGreen( remappedSecondHalf );
            }
        }

        void main(){
            vec2 pos = gl_FragCoord.xy / resolution.xy;
            vec4 heat = texture2D(heatMap,pos);
            gl_FragColor = vec4(heat5(heat.x),heat.x);
        }
    </script>

<body style="width:100%;height:100%;margin:0px;padding:0px;overflow:hidden" onload="initialize()">
<div id="map" style="width:100%;height:100%"></div>
<canvas id="mainCanvas" style="position:absolute;top:0px;left:0px;z-index:2;width:100%;height:100%;margin:0px;padding:0px;pointer-events:none"></canvas>
<div style="position:absolute;z-index:3;top:0px;left:0px;width:100%;height:100%;pointer-events:none">
    <div style="float:right;pointer-events:all">
        <a href="../">Main</a>
    </div>
</div>
</body>
<script src="leaflet-src.js"></script>
<script src="CanvasImageLayer.js"></script>
<script src="../libs/Three.js"></script>
<script src="../libs/OrbitControls.js"></script>
<script src="../libs/stats.min.js"></script>
<script src="../heat/TextureRenderer.js"></script>
<script src="../heat/GaussianSplat.js"></script>
<script src="../heat/JacksonPollock.js"></script>
<script src="../heat/Heatmap.js"></script>
<script src="main.js"></script>
</html>

